# 5. git

**目录：**

[TOC]

---

AcWing 代码托管平台：[AcWing 代码托管平台](git.acwing.com)。

## 一、git 基本概念

git 的工作区、暂存区和版本库的关系：`工作区 -> 暂存区 -> 版本库`。

### 1.1 工作区

工作区即当前的工作目录，亦即仓库的目录。

工作区是独立于各个分支的。

### 1.2 暂存区

数据暂时存放的区域，类似于工作区写入版本库前的缓存区。

暂存区是独立于各个分支的。

### 1.3 版本库

存放所有已经提交到本地仓库的代码版本。

### 1.4 版本结构

git 的版本结构为无向图，且为树结构，树中每个节点代表一个代码版本。

## 二、git 常用命令

### 2.1 全局设置

**1. `git config --global user.name xxx`**

设置全局用户名，信息记录在 `~/.gitconfig` 文件中。

**2. `git config --global user.email xxx@xxx.com`**

设置全局邮箱地址，信息记录在 `~/.gitconfig` 文件中。

**3. `git init`**

将当前目录配置成 git 仓库，信息记录在隐藏的 `.git` 文件夹中。

### 2.2 常用命令

**1. `git add XX`**

将 `XX` 文件添加到暂存区。

* `git add .`：将当前目录下所有待加入暂存区的文件加入暂存区。

**2. `git commit -m "给自己看的备注信息"`**

将暂存区的内容提交到当前分支。

执行此命令后，在 git 的版本结构树中会创建一个新的节点，该新节点代表新的代码版本，且 `HEAD` 指针将会移动并指向该新节点。

**3. `git status`**

查看仓库状态。

**4. `git log`**

查看当前分支的所有版本。

* `git log --pretty=oneline`：将 `log` 记录输出在一行内。

**5. `git push -u`（第一次需要 `-u`，以后不需要）**

将当前分支推送到远程仓库。

**6. `git clone git@git.acwing.com:xxx/XXX.git`**

将远程仓库 `XXX` 下载到当前目录下。

> 注意：使用 SSH 克隆的本质是 `scp` 命令操作。

**7. `git branch`**

查看所有分支和当前所处分支。

### 2.3 查看命令

**1. `git status`**

查看仓库状态。

**2. `git diff XX`**

查看 `XX` 文件相对于暂存区修改了哪些内容。

**3. `git log`**

查看当前分支的所有版本。

> 注意：`git log` 命令输出的树结构，查看时的顺序为从底部向上，即为时间顺序。

* `git log --pretty=oneline`：将 `log` 记录输出在一行内。

**4. `git reflog`**

查看 `HEAD` 指针的移动历史（包括被回滚的版本）。

**5. `git branch`**

查看所有分支和当前所处分支。

### 2.4 删除命令

**1. `git rm --cached XX`**

将文件从仓库索引目录中删掉。

**2. `git checkout - X` 或 `git restore XX`**

将 `XX` 文件尚未加入暂存区的修改全部撤销。

**3. `git restore --staged xx`**

将 `xx` 从暂存区里移除。

### 2.5 代码回滚

**1. `git reset --hard HEAD^` 或 `git reset --hard HEAD~`**

将代码库回滚到上一个版本。

* `git reset --hard HEAD^^`：往上回滚两次，以此类推。
* `git reset --hard HEAD~100`：往上回滚 100 个版本。
* `git reset --hard` 版本号：回滚到某一特定版本。

### 2.6 远程仓库

**1. `git remote add origin git@git.acwing.com:xxx/XXX.git`**

将本地仓库关联到远程仓库。

**2. `git push -u`（第一次需要 `-u`，以后不需要）**

将当前分支推送到远程仓库。

* `git push origin branch_name`：将本地的某个分支推送到远程仓库。

> 注意：`git push` 操作不会切换分支。

**3. `git clone git@git.acwing.com:xxx/XXX.git`**

将远程仓库 `XXX` 下载到当前目录下。

> 注意：使用 SSH 克隆的本质是 `scp` 命令操作。

**4. `git push --set-upstream origin branch_name`**

设置本地的 `branch_name` 分支对应远程仓库的 `branch_name` 分支。

**5. `git push -d origin branch_name`**

删除远程仓库的 `branch_name` 分支。

**6. `git checkout -t origin/branch_name`**

将远程的 `branch_name` 分支拉取到本地。

**7. `git pull`**

将远程仓库的当前分支与本地仓库的当前分支合并。

* `git pull origin branch_name`：将远程仓库的 `branch_name` 分支与本地仓库的当前分支合并。

> 注意：`origin` 表示云端版本。

**8. `git branch --set-upstream-to=origin/branch_name1 branch_name2`**

将远程的 `branch_name1` 分支与本地的 `branch_name2` 分支对应。

### 2.7 分支命令

> 多人开发时，一般不会在主分支上进行开发，而是创建新分支进行开发。

**1. `git checkout -b branch_name`**

创建并切换到 `branch_name` 这个分支。

**2. `git branch`**

查看所有分支和当前所处分支。

**3. `git checkout branch_name`**

切换到 `branch_name` 这个分支。

**4. `git merge branch_name`**

将分支 `branch_name` 合并到当前分支上。

> 注意：
>
> 当待合并的分支产生冲突时，git 将会在产生冲突的文件中进行如下标注：
> ```txt
> # 未产生冲突的部分
> ...
> <<<<<<< HEAD
> # 对于产生冲突的部分，HEAD 分支当前的内容
> =======
> # 对于产生冲突的部分，dev 分支当前的内容
> >>>>>>> dev
> ```
>
> 由上述示例 `.txt` 文件可知，当待合并的分支产生冲突时，git 将会在产生冲突的文件中进行三部分标注，分别用 `<<<<<<<<<<`、`==========`、`>>>>>>>>>>` 进行分隔，其分隔的内容如上述示例 `.txt` 文件所示。

**5. `git branch -d branch_name`**

删除本地仓库的 `branch_name` 分支。

**6. `git branch -d branch_name`**

删除本地仓库的 `branch_name` 分支。

**7. `git branch branch_name`**

创建新分支。

> 注意：分支创建结束后，并不会立即创建一个新的节点，因为新节点总是通过 `commit` 持久化得到的。

**8. `git push --set-upstream origin branch_name`**

设置本地的 `branch_name` 分支对应远程仓库的 `branch_name` 分支。

**9. `git push -d origin branch_name`**

删除远程仓库的 `branch_name` 分支。

**10. `git pull`**

将远程仓库的当前分支与本地仓库的当前分支合并。

* `git pull origin branch_name`：将远程仓库的 `branch_name` 分支与本地仓库的当前分支合并。

> 注意：`origin` 表示云端版本。

**11. `git branch --set-upstream-to=origin/branch_name1 branch_name2`**

将远程的 `branch_name1` 分支与本地的 `branch_name2` 分支对应。

**12. `git checkout -t origin/branch_name`**

将远程的 `branch_name` 分支拉取到本地。

### 2.8 stash 暂存

> stash 暂存只与本地有关，与云端无关。

**1. `git stash`**

将工作区和暂存区中尚未提交的修改存入栈中。

**2. `git stash apply`**

将栈顶存储的修改恢复到当前分支，但不删除栈顶元素。

**3. `git stash drop`**

删除栈顶存储的修改。

**4. `git stash pop`**

将栈顶存储的修改恢复到当前分支，同时删除栈顶元素。

**5. `git stash list`**

查看栈中所有元素。

## 三、云端分支合并

在公司中，你一般没有 `master` 分支的合并权限；因此当你写好代码之后，需要在 GitLab 上的云端代码仓库创建合并分支申请，由你的 Leader 进行审核。

## 四、git 代码仓库的删除

删除本地 git 代码仓库，只需要使用 `rm` 命令删除被初始化为代码仓库的文件夹即可。

删除云端 git 代码仓库，在对应的云端 git 代码仓库平台中的仓库设置中进行删除即可。