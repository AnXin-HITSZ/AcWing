# 4. ssh

**目录：**

[TOC]

---

## 一、ssh 登录

未来在开发的时候，我们可能不止只有一台服务器，每个服务器都是一个 Linux 服务器；需要在终端利用 ssh 登录到服务器中进行开发。

在本地终端或云端终端（AC Terminal）利用 ssh 登录到服务器中时，看到的也同样是一个命令行终端界面。

> 注意：**服务器**和**账号**是两个不同的概念。在租云服务器时，租的是“服务器”而不是“账号”。

### 1.1 基本用法

远程登录服务器：
```bash
ssh user@hostname
```
其中：
* `user`：用户名；
* `hostname`：IP 地址或域名。

> 注意：
> 
> `root` 用户名为拥有最高权限的根目录。
>
> 一般不建议直接在 `root` 根目录下进行开发，可能会损坏服务器；推荐使用 `add user` 添加用户并在该用户目录下进行开发。

第一次登录时会提示：
```bash
The authenticity of host '123.57.47.211 (123.57.47.211)' can't be established.
ECDSA key fingerprint is SHA256:iy237yysfCe013/l+kpDGfEG9xxHxm0dnxnAbJTPpG8.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
```
输入 `yes`，然后回车即可。

> 注意：使用 `exit` 命令或 `Ctrl + d` 组合键即可断开与远程服务器的连接。

这样会将该服务器的信息记录在 `~/.ssh/known_hosts` 文件中。

然后输入密码即可登录到远程服务器中。

> 注意：
>
> 默认登录端口号为 `22`。如果想登录某一特定端口：
> ```bash
> ssh user@hostname -p 22
> ```
>
> 通过以上方式即可登录该特定端口。

### 1.2 配置文件

创建文件 `~/.ssh/config`。

然后在文件中输入：
```config
Host myserver1
    HostName IP地址或域名
    User 用户名

Host myserver2
    HostName IP地址或域名
    User 用户名
```

之后再使用服务器时，可以直接使用别名 `myserver1`、`myserver2`。

### 1.3 密钥登录

创建密钥：
```bash
ssh-keygen
```
然后一直回车即可。

执行结束后，`~/.ssh/` 目录下会多两个文件：
* `id_rsa`：私钥；
* `id_rsa.pub`：公钥。

> 注意：私钥和公钥是一一对应的。

之后想免密码登录哪个服务器，就将公钥传给哪个服务器即可。
例如，想免密登录 `myserver` 服务器，则将公钥中的内容复制到 `myserver` 中的 `~/.ssh/authorized_keys` 文件里即可。

> 注意：如果有多个密钥的话，要注意密钥与密钥之间应使用回车隔开。

也可以使用如下命令一键添加本地公钥：
```bash
ssh-copy-id myserver
```

> 注意：同一公钥可以重复用于多个服务器的免密登录。

### 1.4 执行命令

命令格式：
```bash
ssh user@hostname command
```
其中 `command` 将会在被登录的远程服务器端自动执行，且远程服务器端的标准输出将会重定向到当前终端中。

例如：
```bash
ssh user@hostname ls -a
```
或者：
```bash
# 单引号中的 $i 可以求值
ssh myserver 'for ((i = 0; i < 10; i++)) do echo $i; done'
```
或者：
```bash
# 双引号中的 $i 不可以求值
ssh myserver "for ((i = 0; i < 10; i++)) do echo $i; done"
```

## 二、scp 传文件

### 2.1 基本用法

命令格式：
```bash
scp source destination
```
将 `source` 路径下的文件复制到 `destination` 中。

> 注意：`scp` 命令和 `cp` 命令一样，都会对原有同名文件进行覆盖。

一次复制多个文件：
```bash
scp source1 source2 destination
```

> 注意：`source` 和 `destination` 也可以都为远程服务器端。

`myserver:` 表示网络上的 `myserver` 服务器**从家目录开始**的路径。

复制文件夹：
* 将本地家目录中的 `tmp` 文件夹复制到 `myserver` 服务器中的 `/home/acs/` 目录下：
    ```bash
    scp -r ~/tmp myserver:/home/acs/
    ```
> 注意：`myserver:/home/acs/` 表示网络上的 `myserver` 主机的某个或某些文件或文件夹的绝对路径，其标志为路径前以 `/` 开头。

* 将本地家目录中的 `tmp` 文件夹复制到 `myserver` 服务器中的 `~/homework/` 目录下：
    ```bash
    scp -r ~/tmp myserver:homework/
    ```
> 注意：`myserver:homework/` 表示网络上的 `myserver` 主机从家目录开始的 `homework/` 目录下的路径，其标志为 `myserver:` 之后的路径前不以 `/` 开头。

* 将 `myserver` 服务器中的 `~/homework/` 文件夹复制到本地的当前路径下：
    ```bash
    scp -r myserver:homework .
    ```

指定服务器的端口号：
```bash
scp -P 22 source1 source2 destination
```

> 注意：`scp` 的 `-r`、`-P` 等参数尽量加在 `source` 和 `destination` 之前。

### 2.2 使用 `scp` 配置其他服务器的 `vim` 和 `tmux`

使用 `scp` 配置其他服务器的 `vim` 和 `tmux` 的方式如下：
```bash
scp ~/.vimrc ~/.tmux.conf myserver:
```

即将本地终端的家目录下的 `.vimrc` 和 `.tmux.conf` 传到远程服务器端的家目录下即可完成配置。